name: myActions
on:
  push:
      branches:
        - main

jobs:
  Publish-Pipy:
    runs-on: ubuntu-latest
    steps:
    - name: Build and publish Python ðŸ distributions ðŸ“¦ to PyPI
      if: github.ref == 'refs/heads/master'
      uses: actions/checkout@v3
    - name: Set up Python 3.9
      uses: actions/setup-python@v2
      with:
        python-version: 3.9
    - name: Install pypa/build
      run: >-
        python -m
        pip install
        build
        --user
    - name: Autobump version
            run: |
              pip install --upgrade bumpversion
              VERSION=$(pip show tmtool | grep -oP '(?<=Version: ).*')
              bumpversion --current-version __version__ patch pyproject.toml --allow-dirty
              echo "Version is: ${VERSION}"
              #PLACEHOLDER1='__version__ = "develop"'
              #PLACEHOLDER2='__version__ = "develop"'
              #VERSION_FILE2='pyproject.toml'
              # ensure the placeholder is there. If grep doesn't find the placeholder
              # it exits with exit code 1 and github actions aborts the build. 
              #grep "$PLACEHOLDER1" "$VERSION_FILE1"
              #sed -i "s/$PLACEHOLDER1/__version__ = \"${VERSION}\"/g" "$VERSION_FILE1"
              #grep "$PLACEHOLDER2" "$VERSION_FILE2"
              #sed -i "s/$PLACEHOLDER2/__version__ = \"${VERSION}\"/g" "$VERSION_FILE2"
    - name: Build a binary wheel and a source tarball
      run: >-
        python -m
        build
        --sdist
        --wheel
        --outdir dist/
        .
    - name: Publish distribution ðŸ“¦ to PyPI
      uses: pypa/gh-action-pypi-publish@master
      with:
        password: ${{ secrets.PYPI_API_TOKEN }}
