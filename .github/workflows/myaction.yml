name: myActions
on:
  push:
      branches:
        - main

jobs:
  Publish-Pipy:
    runs-on: ubuntu-latest
    steps:
    - name: Set up Python 3.9 üêç
      uses: actions/setup-python@v2
      with:
        python-version: 3.9
    - name: Install pypa/build
      run: |
        python -m pip install build --user
    - name: checkout code
      uses: actions/checkout@v2
    - name: Autobump and Build a binary wheel + tarball
      run: |
        cd ../
        pip install bumpversion tmtool
        VERSION=$(pip show tmtool | grep -oP '(?<=Version: ).*')
        echo "Current Version is: ${VERSION}"
        echo "Bumping..."
        bumpversion --current-version ${VERSION} patch --allow-dirty pyproject.toml
        N_VERSION=$(grep -oP '(?<=Version: ).*' pyproject.toml)
        echo "New Version is: ${N_VERSION}"
        cd $GITHUB_WORKSPACE
        python -m build --version ${N_VERSION} --sdist --wheel --outdir $GITHUB_WORKSPACE/dist/ $GITHUB_WORKSPACE
    - name: Publish distribution üì¶ to PyPI
      uses: pypa/gh-action-pypi-publish@master
      with:
        password: ${{ secrets.PYPI_API_TOKEN }}
